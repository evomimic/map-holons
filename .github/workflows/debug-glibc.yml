name: Debug nix develop environment

on:
  workflow_dispatch:

jobs:
  debug-nix:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Nix
        uses: cachix/install-nix-action@v24

      - name: Enter nix develop shell
        run: |
          nix develop --command bash -c '
            echo "ğŸ”§ Nix develop shell entered"

            echo
            echo "ğŸ” Checking for stdlib.h"
            find /nix/store -name "stdlib.h" || echo "âŒ stdlib.h not found"

            echo
            echo "ğŸ“‚ Checking expected glibc include path"
            ls -l /nix/store/*glibc*/include/stdlib.h || echo "âŒ /glibc*/include/stdlib.h not found"

            echo
            echo "ğŸ§  C compiler version and paths:"
            gcc --version
            echo

            echo "ğŸ“¤ GCC include paths:"
            echo | gcc -E -x c -v -

            echo
            echo "ğŸ“¤ g++ include paths:"
            echo | g++ -E -x c++ -v -

            echo
            echo "âœ… Diagnostic complete"
          '